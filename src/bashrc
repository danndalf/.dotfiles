#
# .bashrc: executed by bash(1) for non-login shells.
#

# LANGUAGE: US English, UTF-8 default
export LANG=en_US.UTF-8

# HISTORY: Don't add duplicate lines to history file, keep it short
HISTCONTROL=ignoredups:ignorespace
HISTSIZE=1000
HISTFILESIZE=2000
shopt -s histappend

# DIMENSIONS: Update LINES and COLUMNS after each command if necessary
shopt -s checkwinsize

# LESS: Make less more friendly for non-text input files, see lesspipe(1)
[ -x /usr/bin/lesspipe ] && eval "$(SHELL=/bin/sh lesspipe)"

# COLORS: Determine whether we're live in technicolo(u)r
if [ -x /usr/bin/tput ] && tput setaf 1 >&/dev/null; then
	technicolor=rainbow

	export CLICOLOR=1
	export LSCOLORS=gxfxfxfxcxexexbxbxbxbx
	COLOR_WHITE="\[\033[0;37m\]"

else
	technicolor=
fi

# ALIASES: 
if [ `uname` == 'Linux' ]; then
	if [ -n "$technicolor" ]; then
    alias ls='ls --color=auto'
    alias grep='grep --color=auto'
    alias fgrep='fgrep --color=auto'
		alias egrep='egrep --color=auto'
	fi
fi

# TABS: Enable tab completion features if the host supports them
if [ -f /etc/bash_completion ] && ! shopt -oq posix; then
    . /etc/bash_completion

	### Tab-completion for SSH host aliases
	[[ -s "$HOME/.ssh/config" ]] && complete -o default -o nospace -W "$(/bin/grep ^Host ~/.ssh/config | /bin/sed '/\*/d' | /usr/bin/awk '{print $2}')" scp sftp ssh
fi

function make_prompt {
	EXITSTATUS="$?"
	if [ "$EXITSTATUS" -eq "0" ] 
	then
		STATUS=""
	else
		STATUS="ERR $EXITSTATUS "
	fi
	PS1="${COLOR_WHITE}${STATUS}\u@\H:\w \$ "
	PS2=" > "
}

PROMPT_COMMAND=make_prompt

### PATH
export PATH="/usr/local/bin:/var/lib/gems/2.8/bin:/var/lib/gems/1.8/bin:$PATH:$HOME/Scripts:$HOME/.dotfiles/bin:/usr/local/mysql/bin"

### Hacks to make RVM work in OS X Lion
OS=`uname`
if [ "$OS" == "Darwin" ]; then
	cd .
	export CC=/usr/bin/gcc-4.2
	export DYLD_LIBRARY_PATH="/usr/local/mysql/lib:$DYLD_LIBRARY_PATH"

fi

### Ruby Version Manager
[[ -s "$HOME/.rvm/scripts/rvm" ]] && source "$HOME/.rvm/scripts/rvm"

### Quick application of SSH keys to a new host
apply_ssh() {
	/usr/bin/ssh $1 "mkdir -p ~/.ssh && touch ~/.ssh/authorized_keys && chmod go-rwx ~/.ssh ~/.ssh/authorized_keys && cat >> ~/.ssh/authorized_keys" < ~/.ssh/id_*.pub
}

PATH=$PATH:$HOME/.rvm/bin # Add RVM to PATH for scripting

### Make Android SDK work from command line
export ANDROID_SDK=/home/dann/Applications/android-sdk-linux
export NDK=/opt/home/dann/Applications/android-ndk-r8b
export ANDROID_NDK=$NDK
export ANDROID_NATIVE_API_LEVEL=android-16
export PATH=$PATH:$ANDROID_SDK/tools:$ANDROID_SDK/platform-tools

